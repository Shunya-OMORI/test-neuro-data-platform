# /nginx/nginx.conf

# サーバーの基本的な設定
server {
    listen 80;
    server_name localhost;

    # リクエストボディの最大サイズを設定 (メディアファイルアップロードのため)
    client_max_body_size 100M;

    # --- Collector Service Endpoints (Data Ingestion) ---
    location /api/v1/data {
        proxy_pass http://collector:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    location /api/v1/media {
        proxy_pass http://collector:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # --- Session Manager Endpoints (Metadata Management) ---
    location /api/v1/experiments {
        proxy_pass http://session-manager:5003;
        proxy_set_header Host $host;
    }

    location /api/v1/sessions/end {
        proxy_pass http://session-manager:5003;
        proxy_set_header Host $host;
    }

    # --- Realtime Analyzer Endpoints (Live Feedback) ---
    location /api/v1/users/ {
        proxy_pass http://realtime-analyzer:5002;
        proxy_set_header Host $host;
    }

    # --- BIDS Exporter Endpoints (Batch Processing & Download) ---
    location /api/v1/export-tasks/ {
        proxy_pass http://bids-exporter:5004;
        proxy_set_header Host $host;
    }

    location /api/v1/downloads/ {
        proxy_pass http://bids-exporter:5004;
        proxy_set_header Host $host;
    }
}